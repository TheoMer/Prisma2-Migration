# Migration `20200819033028`

This migration has been generated by TheoMer at 8/19/2020, 3:30:28 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "flamingo-production$prod"."Address" DROP CONSTRAINT IF EXiSTS "Address_user_fkey",
ALTER COLUMN "user" SET NOT NULL;

ALTER TABLE "flamingo-production$prod"."CartItem" DROP CONSTRAINT IF EXiSTS "CartItem_user_fkey",
ALTER COLUMN "user" SET NOT NULL;

ALTER TABLE "flamingo-production$prod"."Item" DROP CONSTRAINT IF EXiSTS "Item_color_fkey",
DROP CONSTRAINT IF EXiSTS "Item_size_fkey",
DROP CONSTRAINT IF EXiSTS "Item_user_fkey",
ALTER COLUMN "color" SET NOT NULL,
ALTER COLUMN "size" SET NOT NULL,
ALTER COLUMN "user" SET NOT NULL;

ALTER TABLE "flamingo-production$prod"."ItemVariants" DROP CONSTRAINT IF EXiSTS "ItemVariants_color_fkey",
DROP CONSTRAINT IF EXiSTS "ItemVariants_item_fkey",
DROP CONSTRAINT IF EXiSTS "ItemVariants_size_fkey",
DROP CONSTRAINT IF EXiSTS "ItemVariants_user_fkey",
ALTER COLUMN "color" SET NOT NULL,
ALTER COLUMN "item" SET NOT NULL,
ALTER COLUMN "size" SET NOT NULL,
ALTER COLUMN "user" SET NOT NULL;

ALTER TABLE "flamingo-production$prod"."Order" DROP CONSTRAINT IF EXiSTS "Order_user_fkey",
ALTER COLUMN "user" SET NOT NULL;

ALTER TABLE "flamingo-production$prod"."OrderItem" DROP CONSTRAINT IF EXiSTS "OrderItem_color_fkey",
DROP CONSTRAINT IF EXiSTS "OrderItem_order_fkey",
DROP CONSTRAINT IF EXiSTS "OrderItem_size_fkey",
DROP CONSTRAINT IF EXiSTS "OrderItem_user_fkey",
ALTER COLUMN "color" SET NOT NULL,
ALTER COLUMN "order" SET NOT NULL,
ALTER COLUMN "size" SET NOT NULL,
ALTER COLUMN "user" SET NOT NULL;

ALTER TABLE "flamingo-production$prod"."User" ALTER COLUMN "permissions2" DROP DEFAULT;

ALTER TABLE "flamingo-production$prod"."Address" ADD FOREIGN KEY ("user")REFERENCES "flamingo-production$prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."CartItem" ADD FOREIGN KEY ("user")REFERENCES "flamingo-production$prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."Item" ADD FOREIGN KEY ("color")REFERENCES "flamingo-production$prod"."Color"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."Item" ADD FOREIGN KEY ("size")REFERENCES "flamingo-production$prod"."Size"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."Item" ADD FOREIGN KEY ("user")REFERENCES "flamingo-production$prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."ItemVariants" ADD FOREIGN KEY ("color")REFERENCES "flamingo-production$prod"."Color"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."ItemVariants" ADD FOREIGN KEY ("item")REFERENCES "flamingo-production$prod"."Item"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."ItemVariants" ADD FOREIGN KEY ("size")REFERENCES "flamingo-production$prod"."Size"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."ItemVariants" ADD FOREIGN KEY ("user")REFERENCES "flamingo-production$prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."Order" ADD FOREIGN KEY ("user")REFERENCES "flamingo-production$prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."OrderItem" ADD FOREIGN KEY ("color")REFERENCES "flamingo-production$prod"."Color"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."OrderItem" ADD FOREIGN KEY ("order")REFERENCES "flamingo-production$prod"."Order"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."OrderItem" ADD FOREIGN KEY ("size")REFERENCES "flamingo-production$prod"."Size"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "flamingo-production$prod"."OrderItem" ADD FOREIGN KEY ("user")REFERENCES "flamingo-production$prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "flamingo-production$prod"."_RelayId";

ALTER INDEX "flamingo-production$prod"."flamingo-production$prod.Color.name._UNIQUE" RENAME TO "Color.name"

ALTER INDEX "flamingo-production$prod"."flamingo-production$prod.Size.name._UNIQUE" RENAME TO "Size.name"

ALTER INDEX "flamingo-production$prod"."flamingo-production$prod.User.email._UNIQUE" RENAME TO "User.email"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200819033028
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,211 @@
+generator client {
+  provider = "prisma-client-js"
+  previewFeatures = ["connectOrCreate", "transactionApi"]
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model Address {
+  address_line String
+  card_name    String
+  city         String
+  country      String
+  createdAt    DateTime @default(now())
+  id           String   @id
+  postcode     String
+  updatedAt    DateTime @updatedAt
+  user         String
+  User         User     @relation(fields: [user], references: [id])
+}
+
+model CartItem {
+  createdAt    DateTime      @default(now())
+  id           String        @id
+  item         String?
+  itemvariants String?
+  quantity     Int           @default(1)
+  updatedAt    DateTime      @updatedAt
+  user         String
+  Item         Item?         @relation(fields: [item], references: [id])
+  ItemVariants ItemVariants? @relation(fields: [itemvariants], references: [id])
+  User         User          @relation(fields: [user], references: [id])
+}
+
+model Color {
+  createdAt    DateTime       @default(now())
+  id           String         @id
+  label        String?
+  name         String         @unique
+  updatedAt    DateTime       @updatedAt
+  item         Item[]
+  itemvariants ItemVariants[]
+  orderitem    OrderItem[]
+}
+
+model Item {
+  color           String
+  createdAt       DateTime       @default(now())
+  description     String
+  id              String         @id
+  image           String?
+  image2          String?
+  image3          String?
+  image4          String?
+  image5          String?
+  image6          String?
+  largeImage      String?
+  largeImage2     String?
+  largeImage3     String?
+  largeImage4     String?
+  largeImage5     String?
+  largeImage6     String?
+  mainDescription String
+  price           Int
+  quantity        Int            @default(1)
+  size            String
+  title           String
+  updatedAt       DateTime       @updatedAt
+  user            String
+  userIdentity    String         @default("no-button")
+  Color           Color          @relation(fields: [color], references: [id])
+  Size            Size           @relation(fields: [size], references: [id])
+  User            User           @relation(fields: [user], references: [id])
+  cartitems       CartItem[]
+  itemvariants    ItemVariants[]
+}
+
+model ItemVariants {
+  color           String
+  createdAt       DateTime   @default(now())
+  description     String
+  id              String     @id
+  image           String?
+  image2          String?
+  image3          String?
+  image4          String?
+  image5          String?
+  image6          String?
+  item            String
+  largeImage      String?
+  largeImage2     String?
+  largeImage3     String?
+  largeImage4     String?
+  largeImage5     String?
+  largeImage6     String?
+  mainDescription String
+  price           Int
+  quantity        Int        @default(1)
+  size            String
+  title           String
+  updatedAt       DateTime   @updatedAt
+  user            String
+  Color           Color     @relation(fields: [color], references: [id])
+  Item            Item      @relation(fields: [item], references: [id])
+  Size            Size      @relation(fields: [size], references: [id])
+  User            User      @relation(fields: [user], references: [id])
+  cartitems       CartItem[]
+}
+
+model Order {
+  address_line     String
+  card_brand       String
+  card_name        String
+  charge           String
+  city             String
+  country          String
+  createdAt        DateTime    @default(now())
+  id               String      @id
+  last4card_digits String
+  postcode         String
+  total            Int
+  updatedAt        DateTime    @updatedAt
+  user             String
+  User             User       @relation(fields: [user], references: [id])
+  items            OrderItem[]
+}
+
+model OrderItem {
+  color           String
+  createdAt       DateTime @default(now())
+  description     String
+  id              String   @id
+  image           String
+  itemid          String
+  largeImage      String
+  mainDescription String
+  order           String
+  price           Int
+  quantity        Int      @default(1)
+  size            String
+  title           String
+  updatedAt       DateTime @updatedAt
+  user            String
+  Color           Color    @relation(fields: [color], references: [id])
+  Order           Order    @relation(fields: [order], references: [id])
+  Size            Size     @relation(fields: [size], references: [id])
+  User            User     @relation(fields: [user], references: [id])
+}
+
+model SiteVisits {
+  createdAt  DateTime @default(now())
+  id         String   @id
+  updatedAt  DateTime @updatedAt
+  url        String?
+  urlReferer String?
+  userAgent  String?
+  userID     String?
+  userIP     String?
+  userType   String?
+}
+
+model Size {
+  createdAt    DateTime       @default(now())
+  id           String         @id
+  label        String?
+  name         String         @unique
+  updatedAt    DateTime       @updatedAt
+  item         Item[]
+  itemvariants ItemVariants[]
+  orderitem    OrderItem[]
+}
+
+model User {
+  createdAt        DateTime           @default(now())
+  email            String             @unique
+  id               String             @id
+  name             String
+  password         String
+  permissions2     Permission2[]
+  resetToken       String?
+  resetTokenExpiry Float?
+  updatedAt        DateTime           @updatedAt
+  address          Address[]
+  cart             CartItem[]
+  items            Item[]
+  itemvariants     ItemVariants[]
+  order            Order[]
+  OrderItem        OrderItem[]
+  User_permissions User_permissions[]
+}
+
+model User_permissions {
+  nodeId   String
+  position Int
+  value    String
+  User     User   @relation(fields: [nodeId], references: [id])
+
+  @@id([nodeId, position])
+}
+
+enum Permission2 {
+  ADMIN
+  GUEST_USER
+  ITEMCREATE
+  ITEMDELETE
+  ITEMUPDATE
+  PERMISSIONUPDATE
+  USER
+}
```


